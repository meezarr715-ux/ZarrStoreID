<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZarrStoreID | Top Up Game, Pulsa & Sewa Bot Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap">
    <style>
        /* Semua CSS sebelumnya tetap sama */
        /* Saya tidak mengubah CSS karena sudah lengkap */
        
        /* Hanya menambahkan kategori baru untuk produk bot */
        .product-category.bot {
            background: rgba(255, 107, 0, 0.1);
            color: #FF6B00;
        }
        
        .product-category.premium {
            background: rgba(155, 89, 182, 0.1);
            color: #9B59B6;
        }
    </style>
</head>
<body>
    <!-- Header, Main Content, Footer tetap sama -->
    <!-- Hanya mengubah bagian produk dan admin panel -->

    <main>
        <section id="produk">
            <h2 class="section-title"><i class="fas fa-shopping-bag"></i> Produk Top Up, Pulsa & Sewa Bot</h2>
            
            <div class="product-filters">
                <button class="filter-btn active" data-filter="all">Semua Produk</button>
                <button class="filter-btn" data-filter="game">Game</button>
                <button class="filter-btn" data-filter="pulsa">Pulsa</button>
                <button class="filter-btn" data-filter="kuota">Kuota</button>
                <button class="filter-btn" data-filter="bot">Sewa Bot</button>
                <button class="filter-btn" data-filter="premium">Premium Apps</button>
            </div>
            
            <div class="products-grid" id="productsContainer">
                <!-- Produk akan dimuat otomatis dari LocalStorage -->
            </div>
        </section>
        
        <!-- ... bagian lainnya tetap sama ... -->
    </main>

    <!-- Admin Panel (dimodifikasi untuk fitur backup/restore) -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-modal">
            <div class="admin-header">
                <h2><i class="fas fa-user-secret"></i> Developer Panel - ZarrStoreID</h2>
                <button class="modal-close" id="adminClose">&times;</button>
            </div>
            
            <!-- Sistem Backup/Restore yang Lebih Baik -->
            <div style="margin-bottom: 1.5rem; background: #f8f9ff; padding: 1rem; border-radius: 10px;">
                <h4 style="color: var(--primary); margin-bottom: 1rem;">
                    <i class="fas fa-database"></i> Sistem Backup & Restore
                </h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-export" onclick="backupAllData()" style="background: #17a2b8;">
                        <i class="fas fa-download"></i> Backup Semua Data
                    </button>
                    <button class="btn-export" onclick="restoreAllData()" style="background: #28a745;">
                        <i class="fas fa-upload"></i> Restore Data
                    </button>
                    <button class="btn-export" onclick="generateBackupLink()" style="background: #6a11cb;">
                        <i class="fas fa-link"></i> Buat Link Backup
                    </button>
                </div>
                <div id="backupLinkContainer" style="margin-top: 10px; display: none;">
                    <input type="text" id="backupLink" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <button onclick="copyBackupLink()" class="btn-export" style="background: #6c757d; margin-top: 5px;">
                        <i class="fas fa-copy"></i> Copy Link
                    </button>
                </div>
            </div>
            
            <!-- Form Tambah Produk (diperbarui dengan kategori baru) -->
            <div id="addProductForm" style="display: block;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Tambah/Edit Produk</h3>
                <form id="adminForm" class="admin-form">
                    <div class="form-group">
                        <label for="adminProductName">Nama Produk *</label>
                        <input type="text" id="adminProductName" placeholder="Contoh: Sewa Bot WhatsApp 1 Bulan" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductCategory">Kategori *</label>
                        <select id="adminProductCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="game">Game</option>
                            <option value="pulsa">Pulsa</option>
                            <option value="kuota">Kuota</option>
                            <option value="bot">Sewa Bot</option>
                            <option value="premium">Premium Apps</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductPrice">Harga (Rp) *</label>
                        <input type="number" id="adminProductPrice" placeholder="Contoh: 25000" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductDescription">Deskripsi Singkat *</label>
                        <textarea id="adminProductDescription" placeholder="Deskripsi maksimal 50 karakter" maxlength="50" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductImage">Link Gambar (Catbox) *</label>
                        <input type="url" id="adminProductImage" placeholder="https://files.catbox.moe/gambar.jpg" required>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn-admin" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan Produk
                        </button>
                        <button type="button" class="btn-admin" onclick="resetProductForm()" style="background: #6c757d; flex: 1;">
                            <i class="fas fa-times"></i> Form Baru
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Tombol Cepat untuk Produk Baru -->
            <div style="margin-top: 1.5rem; background: #f0f4ff; padding: 1rem; border-radius: 10px;">
                <h4 style="color: var(--primary); margin-bottom: 1rem;">
                    <i class="fas fa-bolt"></i> Tambah Produk Cepat
                </h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-export" onclick="addSampleBotProducts()" style="background: #FF6B00;">
                        <i class="fas fa-robot"></i> Tambah Bot Samples
                    </button>
                    <button class="btn-export" onclick="addSamplePremiumProducts()" style="background: #9B59B6;">
                        <i class="fas fa-crown"></i> Tambah Premium Samples
                    </button>
                    <button class="btn-export" onclick="importFromTemplate()" style="background: #3498db;">
                        <i class="fas fa-file-import"></i> Import Template
                    </button>
                </div>
            </div>
            
            <!-- Input untuk Restore dari Link -->
            <div style="margin-top: 1.5rem;">
                <h4 style="color: var(--primary); margin-bottom: 1rem;">Restore dari Link Backup</h4>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="restoreLink" placeholder="Tempel link backup di sini" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <button onclick="restoreFromLink()" class="btn-export" style="background: #28a745;">
                        <i class="fas fa-cloud-download-alt"></i> Restore
                    </button>
                </div>
            </div>
            
            <!-- Daftar Produk dan fitur lainnya tetap sama -->
        </div>
    </div>

    <script>
        // ==================== PRODUK DEFAULT (jika LocalStorage kosong) ====================
        const DEFAULT_PRODUCTS = [
            // Game
            {
                id: 1,
                name: "Mobile Legends 86 Diamond",
                category: "game",
                price: 25000,
                description: "Diamond MLBB termurah se-Indonesia",
                image: "auto"
            },
            {
                id: 2,
                name: "Free Fire 100 Diamond",
                category: "game",
                price: 30000,
                description: "Diamond FF siap kirim instan",
                image: "auto"
            },
            {
                id: 3,
                name: "XYRAN Premium 1 Bulan",
                category: "game",
                price: 15000,
                description: "Akun premium Xyran terbaru",
                image: "auto"
            },
            
            // Pulsa & Kuota
            {
                id: 4,
                name: "Pulsa Telkomsel 10.000",
                category: "pulsa",
                price: 12000,
                description: "Pulsa semua operator 24 jam",
                image: "auto"
            },
            {
                id: 5,
                name: "Kuota XL 5GB 30 Hari",
                category: "kuota",
                price: 35000,
                description: "Kuota murah untuk streaming",
                image: "auto"
            },
            
            // Sewa Bot (PRODUK BARU)
            {
                id: 6,
                name: "Sewa Bot WhatsApp 1 Bulan",
                category: "bot",
                price: 50000,
                description: "Bot WA otomatis 24/7",
                image: "auto"
            },
            {
                id: 7,
                name: "Sewa Bot Discord Premium",
                category: "bot",
                price: 75000,
                description: "Bot Discord dengan fitur lengkap",
                image: "auto"
            },
            {
                id: 8,
                name: "Sewa Bot Telegram",
                category: "bot",
                price: 40000,
                description: "Bot Telegram untuk group",
                image: "auto"
            },
            {
                id: 9,
                name: "Sewa Bot Instagram",
                category: "bot",
                price: 60000,
                description: "Auto like, comment & follow",
                image: "auto"
            },
            
            // Premium Apps (PRODUK BARU)
            {
                id: 10,
                name: "Alight Motion Pro Mod",
                category: "premium",
                price: 25000,
                description: "Premium tanpa watermark",
                image: "auto"
            },
            {
                id: 11,
                name: "Capcut Premium 1 Tahun",
                category: "premium",
                price: 35000,
                description: "Akses semua fitur premium",
                image: "auto"
            },
            {
                id: 12,
                name: "Alight Motion Premium 6 Bulan",
                category: "premium",
                price: 45000,
                description: "Update berkala garansi",
                image: "auto"
            },
            {
                id: 13,
                name: "Capcut Pro Lifetime",
                category: "premium",
                price: 50000,
                description: "Akses seumur hidup",
                image: "auto"
            }
        ];

        // ==================== SISTEM BACKUP/RESTORE ====================
        function backupAllData() {
            const allData = {
                products: products,
                config: STORE_CONFIG,
                history: JSON.parse(localStorage.getItem('zarrstore_history') || '[]'),
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const fileName = `zarrstore-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', fileName);
            link.click();
            
            showNotification('Backup berhasil dibuat!', 'success');
        }

        function restoreAllData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const backupData = JSON.parse(event.target.result);
                        
                        if (confirm(`Restore backup?\n\nProduk: ${backupData.products?.length || 0} item\nTanggal: ${backupData.timestamp || 'Tidak diketahui'}\n\nSemua data saat ini akan diganti.`)) {
                            // Restore produk
                            if (backupData.products && Array.isArray(backupData.products)) {
                                products = backupData.products;
                                localStorage.setItem('zarrstore_products', JSON.stringify(products));
                            }
                            
                            // Restore config
                            if (backupData.config) {
                                Object.assign(STORE_CONFIG, backupData.config);
                                localStorage.setItem('zarrstore_config', JSON.stringify(STORE_CONFIG));
                            }
                            
                            // Restore history
                            if (backupData.history && Array.isArray(backupData.history)) {
                                localStorage.setItem('zarrstore_history', JSON.stringify(backupData.history));
                            }
                            
                            // Update UI
                            updateUIFromConfig();
                            const activeFilter = document.querySelector('.filter-btn.active');
                            renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
                            renderTransactionHistory();
                            
                            showNotification('Backup berhasil direstore!', 'success');
                        }
                    } catch (error) {
                        showNotification('File backup tidak valid!', 'error');
                        console.error('Restore error:', error);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function generateBackupLink() {
            const allData = {
                products: products,
                config: STORE_CONFIG,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(allData);
            const base64Data = btoa(encodeURIComponent(dataStr));
            
            // Buat link dengan data encoded
            const backupLink = `${window.location.origin}${window.location.pathname}#backup=${base64Data}`;
            
            document.getElementById('backupLink').value = backupLink;
            document.getElementById('backupLinkContainer').style.display = 'block';
            
            showNotification('Link backup dibuat! Copy dan simpan link ini.', 'info');
        }

        function copyBackupLink() {
            const linkInput = document.getElementById('backupLink');
            linkInput.select();
            document.execCommand('copy');
            showNotification('Link backup berhasil dicopy!', 'success');
        }

        function restoreFromLink() {
            const link = document.getElementById('restoreLink').value.trim();
            if (!link) {
                showNotification('Masukkan link backup terlebih dahulu!', 'error');
                return;
            }
            
            try {
                // Ekstrak data dari hash
                const hashMatch = link.match(/#backup=(.+)$/);
                if (!hashMatch) {
                    showNotification('Format link backup tidak valid!', 'error');
                    return;
                }
                
                const base64Data = hashMatch[1];
                const dataStr = decodeURIComponent(atob(base64Data));
                const backupData = JSON.parse(dataStr);
                
                if (confirm(`Restore dari link?\n\nProduk: ${backupData.products?.length || 0} item\nTanggal: ${backupData.timestamp || 'Tidak diketahui'}`)) {
                    // Restore produk
                    if (backupData.products && Array.isArray(backupData.products)) {
                        products = backupData.products;
                        localStorage.setItem('zarrstore_products', JSON.stringify(products));
                    }
                    
                    // Restore config
                    if (backupData.config) {
                        Object.assign(STORE_CONFIG, backupData.config);
                        localStorage.setItem('zarrstore_config', JSON.stringify(STORE_CONFIG));
                    }
                    
                    // Update UI
                    updateUIFromConfig();
                    const activeFilter = document.querySelector('.filter-btn.active');
                    renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
                    
                    showNotification('Data berhasil direstore dari link!', 'success');
                    document.getElementById('restoreLink').value = '';
                }
            } catch (error) {
                showNotification('Gagal restore dari link! Pastikan link valid.', 'error');
                console.error('Restore from link error:', error);
            }
        }

        // ==================== FUNGSI PRODUK SAMPLE ====================
        function addSampleBotProducts() {
            const sampleBots = [
                {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name: "Sewa Bot WhatsApp Premium",
                    category: "bot",
                    price: 75000,
                    description: "Fitur lengkap + support 24/7",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 2 : 2),
                    name: "Sewa Bot Discord Music",
                    category: "bot",
                    price: 55000,
                    description: "Bot musik kualitas tinggi",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 3 : 3),
                    name: "Sewa Bot TikTok Auto",
                    category: "bot",
                    price: 80000,
                    description: "Auto upload & engagement",
                    image: "auto"
                }
            ];
            
            products.push(...sampleBots);
            saveToLocalStorage();
            
            const activeFilter = document.querySelector('.filter-btn.active');
            renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
            updateProductList();
            
            showNotification(`${sampleBots.length} produk bot ditambahkan!`, 'success');
        }

        function addSamplePremiumProducts() {
            const samplePremium = [
                {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name: "Alight Motion Pro Lifetime",
                    category: "premium",
                    price: 60000,
                    description: "Update seumur hidup",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 2 : 2),
                    name: "Capcut Pro Team",
                    category: "premium",
                    price: 45000,
                    description: "Untuk 3 device sekaligus",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 3 : 3),
                    name: "InShot Premium Mod",
                    category: "premium",
                    price: 30000,
                    description: "Editor video premium",
                    image: "auto"
                }
            ];
            
            products.push(...samplePremium);
            saveToLocalStorage();
            
            const activeFilter = document.querySelector('.filter-btn.active');
            renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
            updateProductList();
            
            showNotification(`${samplePremium.length} produk premium ditambahkan!`, 'success');
        }

        function importFromTemplate() {
            if (confirm("Import template produk standar?\n\nIni akan menambah produk: Game, Pulsa, Bot, dan Premium Apps.")) {
                // Gabungkan dengan produk yang ada (hindari duplikat)
                const existingIds = products.map(p => p.name);
                const newProducts = DEFAULT_PRODUCTS.filter(p => !existingIds.includes(p.name));
                
                if (newProducts.length > 0) {
                    // Atur ID yang unik
                    let maxId = products.length > 0 ? Math.max(...products.map(p => p.id)) : 0;
                    newProducts.forEach(p => {
                        p.id = ++maxId;
                    });
                    
                    products.push(...newProducts);
                    saveToLocalStorage();
                    
                    const activeFilter = document.querySelector('.filter-btn.active');
                    renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
                    updateProductList();
                    
                    showNotification(`${newProducts.length} produk template ditambahkan!`, 'success');
                } else {
                    showNotification('Semua produk template sudah ada!', 'info');
                }
            }
        }

        // ==================== MODIFIKASI FUNGSI RENDER PRODUK ====================
        function getCategoryName(category) {
            const names = { 
                game: 'Game', 
                pulsa: 'Pulsa', 
                kuota: 'Kuota',
                bot: 'Sewa Bot',
                premium: 'Premium Apps'
            };
            return names[category] || category;
        }

        function getCategoryClass(category) {
            return `product-category ${category}`;
        }

        // ==================== AUTO-RESTORE DARI LINK ====================
        function checkForBackupInURL() {
            if (window.location.hash.includes('backup=')) {
                const hashMatch = window.location.hash.match(/backup=(.+)$/);
                if (hashMatch) {
                    const base64Data = hashMatch[1];
                    try {
                        const dataStr = decodeURIComponent(atob(base64Data));
                        const backupData = JSON.parse(dataStr);
                        
                        if (confirm('Backup data ditemukan di URL. Restore sekarang?')) {
                            // Restore produk
                            if (backupData.products && Array.isArray(backupData.products)) {
                                products = backupData.products;
                                localStorage.setItem('zarrstore_products', JSON.stringify(products));
                            }
                            
                            // Restore config
                            if (backupData.config) {
                                Object.assign(STORE_CONFIG, backupData.config);
                                localStorage.setItem('zarrstore_config', JSON.stringify(STORE_CONFIG));
                            }
                            
                            // Clear hash dari URL
                            window.location.hash = '';
                            
                            // Update UI
                            updateUIFromConfig();
                            const activeFilter = document.querySelector('.filter-btn.active');
                            renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
                            
                            showNotification('Data berhasil direstore dari URL!', 'success');
                        } else {
                            // Clear hash jika user menolak
                            window.location.hash = '';
                        }
                    } catch (error) {
                        console.error('Auto-restore error:', error);
                    }
                }
            }
        }

        // ==================== MODIFIKASI FUNGSI LOAD DATA ====================
        function loadFromLocalStorage() {
            // Load produk
            const savedProducts = localStorage.getItem('zarrstore_products');
            if (savedProducts) {
                try {
                    products = JSON.parse(savedProducts);
                } catch (e) {
                    console.error("Error parsing products:", e);
                    products = [...DEFAULT_PRODUCTS]; // Gunakan default jika error
                }
            } else {
                // Jika pertama kali, gunakan produk default
                products = [...DEFAULT_PRODUCTS];
                localStorage.setItem('zarrstore_products', JSON.stringify(products));
            }
            
            // Load config
            const savedConfig = localStorage.getItem('zarrstore_config');
            if (savedConfig) {
                try {
                    Object.assign(STORE_CONFIG, JSON.parse(savedConfig));
                } catch (e) {
                    console.error("Error parsing config:", e);
                }
            }
            
            // Load developer mode
            const savedDevMode = localStorage.getItem('zarrstore_devmode');
            isDeveloperMode = savedDevMode === 'true';
            
            // Check untuk backup di URL
            checkForBackupInURL();
            
            // Update UI dengan config
            updateUIFromConfig();
        }

        // ==================== TAMBAH FUNGSI KE WINDOW ====================
        window.backupAllData = backupAllData;
        window.restoreAllData = restoreAllData;
        window.generateBackupLink = generateBackupLink;
        window.copyBackupLink = copyBackupLink;
        window.restoreFromLink = restoreFromLink;
        window.addSampleBotProducts = addSampleBotProducts;
        window.addSamplePremiumProducts = addSamplePremiumProducts;
        window.importFromTemplate = importFromTemplate;
    </script>
</body>
</html>
