<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZarrStoreID | Top Up Game & Pulsa All Operator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap">
    <style>
        /* ... [Kode CSS sama persis seperti di atas] ... */
        /* Silakan salin semua CSS dari kode sebelumnya di sini */
    </style>
</head>
<body>
    <header>
        <!-- ... [Kode Header sama persis] ... -->
        <!-- Silakan salin semua HTML header dari kode sebelumnya di sini -->
    </header>

    <main>
        <!-- ... [Kode Section sama persis] ... -->
        <!-- Silakan salin semua HTML main dari kode sebelumnya di sini -->
    </main>

    <!-- Modal Order dengan CAPTCHA -->
    <!-- ... [Kode Modal sama persis] ... -->
    <!-- Silakan salin semua HTML modal dari kode sebelumnya di sini -->

    <!-- Admin Panel untuk Developer dengan Fitur Auto Update -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-modal">
            <div class="admin-header">
                <h2><i class="fas fa-user-secret"></i> Developer Panel - ZarrStoreID</h2>
                <button class="modal-close" id="adminClose">&times;</button>
            </div>
            
            <div style="margin-bottom: 1.5rem; background: #f8f9ff; padding: 1rem; border-radius: 10px;">
                <p style="color: var(--primary); margin-bottom: 0.5rem;">
                    <i class="fas fa-info-circle"></i> <strong>Developer Mode Aktif</strong>
                </p>
                <p style="font-size: 0.9rem; color: var(--gray);">
                    Hanya developer yang bisa mengakses panel ini via pola klik rahasia pada Alya Store.
                </p>
            </div>
            
            <!-- FITUR AUTO UPDATE -->
            <div style="margin-bottom: 1.5rem; padding: 1rem; background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%); border-radius: 10px; border-left: 4px solid #17a2b8;">
                <h4 style="color: #17a2b8; margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-sync-alt fa-spin" id="autoUpdateIcon"></i> 
                    <span>Auto Update System</span>
                    <span id="autoUpdateBadge" style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">OFF</span>
                </h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 1rem;">
                    <div>
                        <p style="font-size: 0.9rem; color: var(--dark); margin-bottom: 5px;">
                            <strong>Status:</strong> 
                            <span id="autoUpdateStatus" style="color: #dc3545; font-weight: 600;">Nonaktif</span>
                        </p>
                        <p style="font-size: 0.85rem; color: var(--gray);">
                            Update otomatis setiap 
                            <span id="currentInterval" style="font-weight: 600;">3</span> detik
                        </p>
                    </div>
                    
                    <button class="btn-admin" onclick="toggleAutoUpdate()" id="toggleAutoUpdateBtn" 
                            style="background: #6c757d;">
                        <i class="fas fa-play"></i> Aktifkan
                    </button>
                </div>
                
                <div style="margin-top: 1rem;">
                    <p style="font-size: 0.85rem; color: var(--dark); margin-bottom: 8px;">
                        <i class="fas fa-clock"></i> Interval Pengecekan:
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="interval-btn" data-interval="1000" onclick="setUpdateInterval(1000)">
                            1 Detik
                        </button>
                        <button class="interval-btn active" data-interval="3000" onclick="setUpdateInterval(3000)">
                            3 Detik
                        </button>
                        <button class="interval-btn" data-interval="5000" onclick="setUpdateInterval(5000)">
                            5 Detik
                        </button>
                        <button class="interval-btn" data-interval="10000" onclick="setUpdateInterval(10000)">
                            10 Detik
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #dee2e6;">
                    <p style="font-size: 0.8rem; color: var(--gray);">
                        <i class="fas fa-info-circle"></i> Sistem ini akan otomatis mendeteksi perubahan produk dan update tampilan di semua perangkat (HP, Laptop, Tablet) secara real-time.
                    </p>
                </div>
            </div>
            
            <!-- Form Upload Gambar -->
            <div id="imageUploadContainer" style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9ff; border-radius: 10px;">
                <h4 style="color: var(--primary); margin-bottom: 1rem;">Upload Gambar Produk</h4>
                <div style="display: flex; gap: 10px;">
                    <input type="file" id="imageUpload" accept="image/*" style="flex: 1; padding: 10px; border: 2px dashed var(--secondary); border-radius: 10px; background: white; cursor: pointer;">
                    <button onclick="uploadProductImage()" class="btn-export" style="background: #28a745;">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                </div>
                <div id="uploadPreview" style="margin-top: 1rem;"></div>
                <p style="font-size: 0.85rem; color: var(--gray); margin-top: 0.5rem;">
                    <i class="fas fa-info-circle"></i> Upload gambar ke catbox.moe secara otomatis
                </p>
            </div>
            
            <!-- Form Tambah Produk -->
            <div id="addProductForm" style="display: block;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Tambah/Edit Produk</h3>
                <form id="adminForm" class="admin-form">
                    <div class="form-group">
                        <label for="adminProductName">Nama Produk *</label>
                        <input type="text" id="adminProductName" placeholder="Contoh: Mobile Legends 86 Diamond" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductCategory">Kategori *</label>
                        <select id="adminProductCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="game">Game</option>
                            <option value="pulsa">Pulsa</option>
                            <option value="kuota">Kuota</option>
                            <option value="bot">Sewa Bot</option>
                            <option value="editor">Video Editor</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductPrice">Harga (Rp) *</label>
                        <input type="number" id="adminProductPrice" placeholder="Contoh: 25000" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductDescription">Deskripsi Singkat *</label>
                        <textarea id="adminProductDescription" placeholder="Deskripsi maksimal 50 karakter" maxlength="50" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminProductImage">Link Gambar (Catbox) *</label>
                        <input type="url" id="adminProductImage" placeholder="https://files.catbox.moe/gambar.jpg" required>
                        <small style="color: var(--gray); font-size: 0.85rem;">
                            Upload gambar di atas atau masukkan manual link catbox.moe
                        </small>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn-admin" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan Produk
                        </button>
                        <button type="button" class="btn-admin" onclick="resetProductForm()" style="background: #6c757d; flex: 1;">
                            <i class="fas fa-times"></i> Form Baru
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Pengaturan Toko -->
            <div style="margin-top: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Pengaturan Toko</h3>
                <form id="settingsForm" class="admin-form">
                    <div class="form-group">
                        <label for="storeName">Nama Toko *</label>
                        <input type="text" id="storeName" value="ZarrStoreID" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="storePhone">Nomor WhatsApp *</label>
                        <input type="text" id="storePhone" value="6288295039238" required>
                        <small style="color: var(--gray);">Format: 628xxxxxxxxxx (tanpa +)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeQRIS">Link QRIS</label>
                        <input type="url" id="storeQRIS" placeholder="https://files.catbox.moe/qris.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeLogo">Link Logo Toko</label>
                        <input type="url" id="storeLogo" placeholder="https://files.catbox.moe/logo.jpg">
                    </div>
                    
                    <button type="button" class="btn-admin" onclick="saveStoreSettings()">
                        <i class="fas fa-save"></i> Simpan Pengaturan
                    </button>
                </form>
            </div>
            
            <!-- Daftar Produk -->
            <div style="margin-top: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">
                    Daftar Produk (<span id="productCount">0</span>)
                    <button onclick="refreshProductsDisplay()" class="btn-export" style="background: #6a11cb; padding: 5px 10px; margin-left: 10px;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </h3>
                <div id="productList" style="max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 10px; padding: 1rem;">
                    <!-- Daftar produk akan muncul di sini -->
                </div>
            </div>
            
            <!-- Export/Import Data -->
            <div class="export-section">
                <h4 style="color: var(--primary); margin-bottom: 1rem;">Backup Data</h4>
                <button class="btn-export" onclick="exportProducts()">
                    <i class="fas fa-download"></i> Export Produk ke File
                </button>
                <button class="btn-export" onclick="importProducts()" style="background: #28a745;">
                    <i class="fas fa-upload"></i> Import Produk dari File
                </button>
                <button class="btn-export" onclick="refreshProductImages()" style="background: #6a11cb;">
                    <i class="fas fa-sync-alt"></i> Refresh Gambar Produk
                </button>
                <button class="btn-export" onclick="clearAllProducts()" style="background: #dc3545;">
                    <i class="fas fa-trash"></i> Hapus Semua Produk
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
            
            <!-- Developer Tools -->
            <div style="margin-top: 2rem; padding: 1rem; background: #f8f9ff; border-radius: 10px;">
                <h4 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-tools"></i> Developer Tools</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-export" onclick="addSampleProducts()" style="background: #6f42c1;">
                        <i class="fas fa-magic"></i> Tambah Produk Contoh
                    </button>
                    <button class="btn-export" onclick="checkLocalStorage()" style="background: #17a2b8;">
                        <i class="fas fa-database"></i> Cek LocalStorage
                    </button>
                    <button class="btn-export" onclick="clearAllData()" style="background: #dc3545;">
                        <i class="fas fa-broom"></i> Reset Semua Data
                    </button>
                    <button class="btn-export" onclick="forceUpdateAllDevices()" style="background: #ffc107; color: #000;">
                        <i class="fas fa-broadcast-tower"></i> Force Update All
                    </button>
                </div>
            </div>
            
            <!-- Logout Button -->
            <div style="margin-top: 2rem; text-align: center;">
                <button class="btn-admin" onclick="disableDeveloperMode()" style="background: #6c757d;">
                    <i class="fas fa-power-off"></i> Matikan Developer Mode
                </button>
            </div>
        </div>
    </div>

    <!-- Floating WhatsApp -->
    <a href="https://wa.me/6288295039238?text=Halo%20ZarrStoreID,%20saya%20ingin%20bertanya%20tentang%20produk" class="floating-wa" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3 id="storeNameFooter">ZarrStoreID</h3>
                <p>Toko online terpercaya untuk top up game dan pulsa semua operator di Indonesia</p>
            </div>
            
            <div class="footer-section">
                <h3>Metode Pembayaran</h3>
                <p>DANA, GOPAY, OVO, QRIS</p>
                <p>Pembayaran aman dan terenkripsi</p>
            </div>
            
            <div class="footer-section">
                <h3>Layanan Pelanggan</h3>
                <p>WhatsApp: +62 882-9503-9238</p>
                <p>Email: zaenulenka@gmail.com</p>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; 2023 - <span id="currentYear">2026</span> <span id="storeNameCopyright">ZarrStoreID</span>. zarrstore.my.id. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // ==================== KONFIGURASI TOKO ====================
        const STORE_CONFIG = {
            storeName: "ZarrStoreID",
            phoneNumber: "6288295039238",
            qrisUrl: "https://files.catbox.moe/xxxxxx.png",
            storeLogo: "https://files.catbox.moe/gua633.jpg"
        };

        // ==================== DATA PRODUK ====================
        let products = [
            // Produk Game
            {
                id: 1,
                name: "Mobile Legends 86 Diamond",
                category: "game",
                price: 25000,
                description: "Diamond MLBB termurah se-Indonesia",
                image: "https://files.catbox.moe/l2o3mh.jpg"
            },
            {
                id: 2,
                name: "Free Fire 100 Diamond",
                category: "game",
                price: 30000,
                description: "Diamond FF siap kirim instan",
                image: "https://files.catbox.moe/hqw3n7.jpg"
            },
            {
                id: 3,
                name: "XYRAN Premium 1 Bulan",
                category: "game",
                price: 15000,
                description: "Akun premium Xyran terbaru",
                image: "https://files.catbox.moe/lgh3p1.jpg"
            },
            
            // Produk Pulsa
            {
                id: 4,
                name: "Pulsa Telkomsel 10.000",
                category: "pulsa",
                price: 12000,
                description: "Pulsa semua operator 24 jam",
                image: "https://files.catbox.moe/p3q4r2.jpg"
            },
            {
                id: 5,
                name: "Pulsa Tri 5.000",
                category: "pulsa",
                price: 7000,
                description: "Pulsa Tri murah langsung aktif",
                image: "https://files.catbox.moe/s4r5t3.jpg"
            },
            
            // Produk Sewa Bot
            {
                id: 6,
                name: "Sewa Bot WhatsApp 1 Minggu",
                category: "bot",
                price: 15000,
                description: "Bot WA multifungsi premium",
                image: "https://files.catbox.moe/m6n7u4.jpg"
            },
            {
                id: 7,
                name: "Sewa Bot Instagram 1 Bulan",
                category: "bot",
                price: 30000,
                description: "Bot IG auto like & follow",
                image: "https://files.catbox.moe/v7w8x5.jpg"
            },
            {
                id: 8,
                name: "Sewa Bot TikTok 2 Minggu",
                category: "bot",
                price: 25000,
                description: "Bot TikTok views & followers",
                image: "https://files.catbox.moe/y8x9z6.jpg"
            },
            
            // Produk Video Editor
            {
                id: 9,
                name: "Alight Motion Premium 3 Bulan",
                category: "editor",
                price: 35000,
                description: "Full fitur tanpa watermark",
                image: "https://files.catbox.moe/z9a0b7.jpg"
            },
            {
                id: 10,
                name: "Capcut Pro 1 Bulan",
                category: "editor",
                price: 20000,
                description: "All template unlocked",
                image: "https://files.catbox.moe/a0b1c8.jpg"
            },
            {
                id: 11,
                name: "Alight Motion Premium 1 Tahun",
                category: "editor",
                price: 80000,
                description: "Akun premium lifetime access",
                image: "https://files.catbox.moe/b1c2d9.jpg"
            },
            {
                id: 12,
                name: "Capcut Pro 6 Bulan",
                category: "editor",
                price: 50000,
                description: "Premium effects & transitions",
                image: "https://files.catbox.moe/c2d3e0.jpg"
            }
        ];

        // ==================== DATA COLLABORATOR ====================
        const collaborators = [
            { name: "SabaMart", secret: false },
            { name: "AqilDevv", secret: false },
            { name: "Wanz Preset", secret: false },
            { name: "Vion Shizawa", secret: false },
            { name: "Alya Store", secret: true, developer: true },
            { name: "Mahiro Editz", secret: false },
            { name: "Suzza Preset", secret: false },
            { name: "Xyran", secret: false },
            { name: "BotMaster ID", secret: false },
            { name: "EditorPro", secret: false }
        ];

        // ==================== VARIABEL GLOBAL ====================
        let currentProduct = products[0];
        let selectedPaymentMethod = null;
        let isDeveloperMode = false;
        let currentEditProductId = null;
        let secretClickCount = 0;
        let lastSecretClickTime = 0;
        let secretElement = null;
        let currentCaptcha = '';
        let captchaVerified = false;
        let robotChecked = false;
        let isTouchDevice = false;

        // ==================== FITUR AUTO UPDATE ====================
        let autoUpdateInterval = null;
        let lastProductHash = '';
        let isAutoUpdateEnabled = false;
        let currentUpdateInterval = 3000;
        let lastUpdateTime = Date.now();

        // ==================== FUNGSI AUTO UPDATE ====================
        function calculateProductHash() {
            if (products.length === 0) return 'empty';
            
            const productsString = JSON.stringify(products.map(p => ({
                id: p.id,
                name: p.name,
                price: p.price,
                category: p.category,
                description: p.description,
                image: p.image
            })).sort((a, b) => a.id - b.id));
            
            let hash = 0;
            for (let i = 0; i < productsString.length; i++) {
                const char = productsString.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(16);
        }

        function checkForProductChanges() {
            const currentHash = calculateProductHash();
            
            if (lastProductHash === '') {
                lastProductHash = currentHash;
                return false;
            }
            
            if (currentHash !== lastProductHash) {
                console.log(`[Auto Update] Hash berubah: ${lastProductHash} -> ${currentHash}`);
                lastProductHash = currentHash;
                return true;
            }
            
            return false;
        }

        function autoUpdateProducts() {
            if (!isAutoUpdateEnabled) return;
            
            const now = Date.now();
            if (now - lastUpdateTime < currentUpdateInterval) return;
            
            const hasChanges = checkForProductChanges();
            
            if (hasChanges) {
                lastUpdateTime = now;
                console.log('[Auto Update] Mendeteksi perubahan produk!');
                
                // Simpan perubahan ke localStorage (trigger cross-tab sync)
                saveToLocalStorage();
                
                // Update tampilan produk
                updateAllProductDisplays();
                
                // Update timestamp di UI
                updateLastUpdateTime();
                
                // Tampilkan notifikasi halus
                showAutoUpdateNotification();
            }
        }

        function updateAllProductDisplays() {
            // Dapatkan filter aktif saat ini
            const activeFilterBtn = document.querySelector('.filter-btn.active');
            const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-filter') : 'all';
            
            // Update tampilan utama produk
            renderProducts(currentFilter);
            
            // Update product list di admin panel jika terbuka
            if (document.getElementById('adminPanel').style.display === 'flex') {
                updateProductList();
            }
            
            console.log('[Auto Update] Semua tampilan produk telah diperbarui');
        }

        function updateLastUpdateTime() {
            const timeElement = document.getElementById('lastUpdateTime');
            if (timeElement) {
                const now = new Date();
                timeElement.textContent = now.toLocaleTimeString('id-ID');
            }
        }

        function showAutoUpdateNotification() {
            // Notifikasi halus tanpa mengganggu user
            if (document.hidden) return; // Skip jika tab tidak aktif
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 80px;
                right: 20px;
                background: rgba(106, 17, 203, 0.9);
                color: white;
                padding: 8px 15px;
                border-radius: 20px;
                font-size: 0.85rem;
                z-index: 9999;
                display: flex;
                align-items: center;
                gap: 8px;
                backdrop-filter: blur(10px);
                animation: slideInUp 0.3s ease;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-sync-alt fa-spin"></i>
                <span>Produk diperbarui</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        function startAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
            }
            
            isAutoUpdateEnabled = true;
            lastProductHash = calculateProductHash();
            lastUpdateTime = Date.now();
            
            // Interval yang lebih sering untuk pengecekan
            autoUpdateInterval = setInterval(autoUpdateProducts, 1000);
            
            // Update UI
            updateAutoUpdateUI();
            
            console.log(`[Auto Update] Dimulai dengan interval ${currentUpdateInterval}ms`);
            showNotification('üîÑ Auto Update diaktifkan', 'success');
        }

        function stopAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
            }
            
            isAutoUpdateEnabled = false;
            
            // Update UI
            updateAutoUpdateUI();
            
            console.log('[Auto Update] Dihentikan');
            showNotification('‚è∏Ô∏è Auto Update dihentikan', 'info');
        }

        function toggleAutoUpdate() {
            if (isAutoUpdateEnabled) {
                stopAutoUpdate();
            } else {
                startAutoUpdate();
            }
        }

        function setUpdateInterval(interval) {
            currentUpdateInterval = interval;
            
            // Update UI interval buttons
            document.querySelectorAll('.interval-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-interval')) === interval) {
                    btn.classList.add('active');
                }
            });
            
            // Update display
            document.getElementById('currentInterval').textContent = (interval / 1000).toString();
            
            // Restart auto update dengan interval baru jika sedang aktif
            if (isAutoUpdateEnabled) {
                startAutoUpdate();
            }
            
            showNotification(`‚è±Ô∏è Interval diubah ke ${interval/1000} detik`, 'info');
        }

        function updateAutoUpdateUI() {
            const statusElement = document.getElementById('autoUpdateStatus');
            const buttonElement = document.getElementById('toggleAutoUpdateBtn');
            const badgeElement = document.getElementById('autoUpdateBadge');
            const iconElement = document.getElementById('autoUpdateIcon');
            
            if (isAutoUpdateEnabled) {
                statusElement.textContent = 'Aktif';
                statusElement.style.color = '#28a745';
                buttonElement.innerHTML = '<i class="fas fa-pause"></i> Matikan';
                buttonElement.style.background = '#dc3545';
                badgeElement.textContent = 'ON';
                badgeElement.style.background = '#28a745';
                iconElement.classList.add('fa-spin');
            } else {
                statusElement.textContent = 'Nonaktif';
                statusElement.style.color = '#dc3545';
                buttonElement.innerHTML = '<i class="fas fa-play"></i> Aktifkan';
                buttonElement.style.background = '#28a745';
                badgeElement.textContent = 'OFF';
                badgeElement.style.background = '#dc3545';
                iconElement.classList.remove('fa-spin');
            }
        }

        function forceUpdateAllDevices() {
            // Force update dengan mengubah timestamp di localStorage
            localStorage.setItem('zarrstore_force_update', Date.now().toString());
            
            // Update produk di halaman ini
            updateAllProductDisplays();
            
            // Tampilkan notifikasi
            showNotification('üöÄ Memaksa update di semua perangkat...', 'success');
            
            console.log('[Force Update] Memicu update di semua perangkat');
        }

        // Cross-tab synchronization
        function setupCrossTabSync() {
            window.addEventListener('storage', function(event) {
                if (event.key === 'zarrstore_products' && event.newValue) {
                    try {
                        const newProducts = JSON.parse(event.newValue);
                        const oldHash = calculateProductHash();
                        products = newProducts;
                        const newHash = calculateProductHash();
                        
                        if (oldHash !== newHash) {
                            console.log('[Cross-Tab] Mendeteksi perubahan produk dari tab lain');
                            
                            // Update tampilan
                            updateAllProductDisplays();
                            
                            // Notifikasi
                            showNotification('üîÑ Produk diperbarui dari tab lain', 'info');
                        }
                    } catch (error) {
                        console.error('Error parsing cross-tab update:', error);
                    }
                }
                
                // Force update trigger
                if (event.key === 'zarrstore_force_update') {
                    console.log('[Cross-Tab] Force update diterima');
                    updateAllProductDisplays();
                    showNotification('üîÑ Produk diperbarui (force update)', 'info');
                }
            });
        }

        // ==================== DETEKSI DEVICE ====================
        function detectDevice() {
            isTouchDevice = 'ontouchstart' in window || 
                           navigator.maxTouchPoints > 0 || 
                           navigator.msMaxTouchPoints > 0;
            
            if (isTouchDevice) {
                document.body.classList.add('touch-device');
            } else {
                document.body.classList.add('hover-device');
            }
        }

        // ==================== SISTEM CAPTCHA ====================
        function generateCaptcha() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
            let captcha = '';
            for (let i = 0; i < 6; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            currentCaptcha = captcha;
            return captcha;
        }

        function renderCaptcha() {
            const captchaText = document.getElementById('captchaText');
            if (captchaText) {
                captchaText.textContent = generateCaptcha();
            }
        }

        function verifyCaptcha() {
            const input = document.getElementById('captchaInput').value.toUpperCase();
            const status = document.getElementById('captchaStatus');
            
            if (!input) {
                status.textContent = 'Masukkan kode verifikasi';
                status.className = 'captcha-status error';
                return false;
            }
            
            if (input === currentCaptcha.toUpperCase()) {
                status.textContent = '‚úì Verifikasi berhasil!';
                status.className = 'captcha-status success';
                captchaVerified = true;
                updateSendButton();
                return true;
            } else {
                status.textContent = '‚úó Kode tidak sesuai. Coba lagi.';
                status.className = 'captcha-status error';
                captchaVerified = false;
                updateSendButton();
                setTimeout(() => {
                    renderCaptcha();
                    document.getElementById('captchaInput').value = '';
                }, 1000);
                return false;
            }
        }

        function setupCaptcha() {
            renderCaptcha();
            
            document.getElementById('refreshCaptcha').addEventListener('click', function() {
                renderCaptcha();
                document.getElementById('captchaInput').value = '';
                document.getElementById('captchaStatus').textContent = '';
                captchaVerified = false;
                updateSendButton();
            });
            
            document.getElementById('verifyCaptcha').addEventListener('click', verifyCaptcha);
            
            document.getElementById('captchaInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    verifyCaptcha();
                }
            });
            
            document.getElementById('audioCaptcha').addEventListener('click', function() {
                showNotification('Fitur audio CAPTCHA akan segera hadir!', 'info');
            });
        }

        // ==================== VERIFIKASI ROBOT ====================
        function setupRobotVerification() {
            const checkbox = document.getElementById('robotCheckbox');
            const checkInput = document.getElementById('robotCheck');
            
            checkbox.addEventListener('click', function() {
                robotChecked = !robotChecked;
                checkInput.checked = robotChecked;
                
                if (robotChecked) {
                    checkbox.classList.add('checked');
                    this.style.background = '#e8f5e9';
                } else {
                    checkbox.classList.remove('checked');
                    this.style.background = '';
                }
                
                updateSendButton();
            });
        }

        function updateSendButton() {
            const sendButton = document.getElementById('sendWhatsApp');
            if (robotChecked && captchaVerified) {
                sendButton.disabled = false;
                sendButton.innerHTML = '<i class="fab fa-whatsapp"></i> Kirim ke WhatsApp';
                sendButton.style.background = 'linear-gradient(to right, #25D366, #128C7E)';
            } else {
                sendButton.disabled = true;
                sendButton.innerHTML = '<i class="fas fa-lock"></i> Selesaikan Verifikasi';
                sendButton.style.background = '#6c757d';
            }
        }

        // ==================== FUNGSI GAMBAR OTOMATIS ====================
        function getProductImageUrl(product) {
            if (product.image && product.image !== 'auto' && product.image.startsWith('http')) {
                const separator = product.image.includes('?') ? '&' : '?';
                return product.image + separator + 't=' + Date.now();
            }
            
            const productName = encodeURIComponent(product.name.toLowerCase()
                .replace(/[^\w\s]/gi, '')
                .replace(/\s+/g, '-')
                .substring(0, 20));
            
            return `https://via.placeholder.com/300/6a11cb/FFFFFF?text=${productName}&t=${Date.now()}`;
        }

        // ==================== INISIALISASI ====================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            detectDevice();
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            loadFromLocalStorage();
            setupNavigation();
            setupProductFilters();
            setupPayment();
            setupMobileMenu();
            setupOrderModal();
            setupCopyButtons();
            setupCollaborators();
            setupCaptcha();
            setupRobotVerification();
            renderProducts('all');
            renderTransactionHistory();
            updateOrderSummary(currentProduct);
            loadQRISImage();
            setupAdminPanel();
            setupCrossTabSync();
            
            // Start auto update jika sebelumnya aktif
            if (isAutoUpdateEnabled) {
                startAutoUpdate();
            }
            
            window.addEventListener('resize', handleResize);
            optimizeForChrome();
        }

        function optimizeForChrome() {
            const elements = document.querySelectorAll('.product-card, .btn, .payment-option');
            elements.forEach(el => {
                el.style.transform = 'translateZ(0)';
            });
        }

        function handleResize() {
            detectDevice();
        }

        // ==================== FUNGSI LOCALSTORAGE ====================
        function loadFromLocalStorage() {
            const savedProducts = localStorage.getItem('zarrstore_products');
            if (savedProducts) {
                try {
                    products = JSON.parse(savedProducts);
                } catch (e) {
                    console.error("Error parsing products:", e);
                    products = [];
                }
            }
            
            const savedConfig = localStorage.getItem('zarrstore_config');
            if (savedConfig) {
                try {
                    Object.assign(STORE_CONFIG, JSON.parse(savedConfig));
                } catch (e) {
                    console.error("Error parsing config:", e);
                }
            }
            
            const savedDevMode = localStorage.getItem('zarrstore_devmode');
            isDeveloperMode = savedDevMode === 'true';
            
            const savedAutoUpdate = localStorage.getItem('zarrstore_autoupdate');
            if (savedAutoUpdate) {
                isAutoUpdateEnabled = savedAutoUpdate === 'true';
            }
            
            updateUIFromConfig();
        }

        function saveToLocalStorage() {
            localStorage.setItem('zarrstore_products', JSON.stringify(products));
            localStorage.setItem('zarrstore_config', JSON.stringify(STORE_CONFIG));
            localStorage.setItem('zarrstore_devmode', isDeveloperMode.toString());
            localStorage.setItem('zarrstore_autoupdate', isAutoUpdateEnabled.toString());
            
            // Update last hash
            lastProductHash = calculateProductHash();
            
            // Trigger cross-tab sync
            const syncTime = Date.now().toString();
            localStorage.setItem('zarrstore_last_sync', syncTime);
            
            // Trigger custom event
            const event = new Event('productsUpdated');
            window.dispatchEvent(event);
        }

        function updateUIFromConfig() {
            document.querySelectorAll('.payment-number').forEach(el => {
                const number = STORE_CONFIG.phoneNumber.replace('62', '0');
                el.textContent = number;
                el.setAttribute('data-number', number);
            });
            
            document.getElementById('storeNameFooter').textContent = STORE_CONFIG.storeName;
            document.getElementById('storeNameCopyright').textContent = STORE_CONFIG.storeName;
            
            const floatingWA = document.querySelector('.floating-wa');
            if (floatingWA) {
                floatingWA.href = `https://wa.me/${STORE_CONFIG.phoneNumber}?text=Halo%20${encodeURIComponent(STORE_CONFIG.storeName)}%2C%20saya%20ingin%20bertanya%20tentang%20produk`;
            }
            
            if (document.getElementById('storeName')) {
                document.getElementById('storeName').value = STORE_CONFIG.storeName;
                document.getElementById('storePhone').value = STORE_CONFIG.phoneNumber;
                document.getElementById('storeQRIS').value = STORE_CONFIG.qrisUrl;
                document.getElementById('storeLogo').value = STORE_CONFIG.storeLogo;
            }
            
            const logoImg = document.querySelector('.logo-img');
            if (logoImg && STORE_CONFIG.storeLogo) {
                logoImg.src = STORE_CONFIG.storeLogo;
            }
        }

        // ==================== FUNGSI COLLABORATOR ====================
        function setupCollaborators() {
            const container = document.getElementById('collaboratorsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            const shuffled = [...collaborators].sort(() => Math.random() - 0.5);
            
            shuffled.forEach(collab => {
                const supporter = document.createElement('div');
                supporter.className = 'supporter';
                supporter.textContent = collab.name;
                supporter.title = `Supporter ZarrStoreID: ${collab.name}`;
                
                if (collab.secret && collab.developer) {
                    supporter.classList.add('developer-hidden');
                    secretElement = supporter;
                    supporter.addEventListener('click', handleSecretDeveloperClick);
                    supporter.style.cursor = 'default';
                } else {
                    supporter.style.cursor = 'default';
                }
                
                container.appendChild(supporter);
            });
        }

        function handleSecretDeveloperClick(e) {
            const currentTime = new Date().getTime();
            
            if (currentTime - lastSecretClickTime > 2000) {
                secretClickCount = 0;
            }
            
            secretClickCount++;
            lastSecretClickTime = currentTime;
            
            this.style.transform = 'translateY(-2px)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
            
            if (secretClickCount >= 3) {
                activateDeveloperMode();
                secretClickCount = 0;
                
                this.style.boxShadow = '0 0 0 2px rgba(106, 17, 203, 0.2)';
                setTimeout(() => {
                    this.style.boxShadow = '';
                }, 300);
            }
        }

        function activateDeveloperMode() {
            isDeveloperMode = true;
            saveToLocalStorage();
            showNotification('Developer mode diaktifkan', 'success');
            setTimeout(() => {
                openAdminPanel();
            }, 500);
        }

        function setupAdminPanel() {
            document.getElementById('adminClose').addEventListener('click', function() {
                document.getElementById('adminPanel').style.display = 'none';
            });
            
            document.getElementById('adminPanel').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            document.getElementById('adminForm').addEventListener('submit', addProduct);
            
            document.getElementById('importFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (Array.isArray(imported)) {
                            products = imported.filter(p => p.id && p.name && p.category && p.price);
                            saveToLocalStorage();
                            renderProducts('all');
                            updateProductList();
                            showNotification(`${products.length} produk diimport!`, 'success');
                        }
                    } catch (error) {
                        showNotification('File tidak valid!', 'error');
                    }
                    e.target.value = '';
                };
                reader.readAsText(file);
            });
            
            // Style untuk interval buttons
            const style = document.createElement('style');
            style.textContent = `
                .interval-btn {
                    padding: 5px 10px;
                    background: white;
                    border: 1px solid #dee2e6;
                    border-radius: 5px;
                    font-size: 0.85rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                .interval-btn:hover {
                    background: #f8f9fa;
                }
                .interval-btn.active {
                    background: var(--secondary);
                    color: white;
                    border-color: var(--secondary);
                }
                @keyframes slideInUp {
                    from { transform: translateY(20px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        function openAdminPanel() {
            if (!isDeveloperMode) return;
            
            document.getElementById('adminPanel').style.display = 'flex';
            updateProductList();
            updateUIFromConfig();
            resetProductForm();
            updateAutoUpdateUI();
        }

        function disableDeveloperMode() {
            if (confirm('Matikan Developer Mode?\nAnda akan keluar dari panel admin.')) {
                isDeveloperMode = false;
                secretClickCount = 0;
                saveToLocalStorage();
                document.getElementById('adminPanel').style.display = 'none';
                showNotification('Developer Mode telah dimatikan', 'success');
            }
        }

        // ==================== FUNGSI UPLOAD GAMBAR ====================
        async function uploadProductImage() {
            const input = document.getElementById('imageUpload');
            const file = input.files[0];
            
            if (!file) {
                showNotification('Pilih gambar terlebih dahulu!', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Ukuran gambar maksimal 5MB!', 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showNotification('File harus berupa gambar!', 'error');
                return;
            }
            
            try {
                showNotification('Mengupload gambar...', 'info');
                
                const preview = document.getElementById('uploadPreview');
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" style="max-width: 150px; max-height: 150px; border-radius: 10px; border: 2px solid var(--secondary);">
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Preview gambar</p>
                    `;
                };
                reader.readAsDataURL(file);
                
                setTimeout(() => {
                    const productName = document.getElementById('adminProductName').value || 'product';
                    const fileName = productName.toLowerCase()
                        .replace(/[^\w\s]/gi, '')
                        .replace(/\s+/g, '-')
                        .substring(0, 20);
                    
                    const dummyUrl = `https://files.catbox.moe/${fileName}-${Date.now()}.jpg`;
                    document.getElementById('adminProductImage').value = dummyUrl;
                    showNotification('Gambar siap digunakan! URL otomatis diisi', 'success');
                    input.value = '';
                }, 1500);
                
            } catch (error) {
                console.error('Upload error:', error);
                showNotification('Gagal upload gambar: ' + error.message, 'error');
            }
        }

        // ==================== FUNGSI PRODUK ====================
        function getCategoryName(category) {
            const names = { 
                game: 'Game', 
                pulsa: 'Pulsa', 
                kuota: 'Kuota',
                bot: 'Sewa Bot',
                editor: 'Video Editor'
            };
            return names[category] || category;
        }

        function getCategoryClass(category) {
            const classes = {
                bot: 'category-bot',
                editor: 'category-editor'
            };
            return classes[category] || '';
        }

        function renderProducts(filter) {
            const container = document.getElementById('productsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            const filteredProducts = filter === 'all' 
                ? products 
                : products.filter(p => p.category === filter);
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: var(--gray); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--gray);">Belum ada produk</h3>
                        <p>Tambahkan produk melalui panel developer</p>
                    </div>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const imageUrl = getProductImageUrl(product);
                const card = document.createElement('div');
                card.className = 'product-card';
                const categoryClass = getCategoryClass(product.category);
                card.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name}" class="product-img" 
                         onerror="this.onerror=null; this.src='https://via.placeholder.com/300/6a11cb/FFFFFF?text=${encodeURIComponent(product.name.substring(0, 20))}'">
                    <div class="product-content">
                        <div class="product-category ${categoryClass}">${getCategoryName(product.category)}</div>
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">Rp ${product.price.toLocaleString('id-ID')}</div>
                        <p class="product-desc">${product.description}</p>
                        <div class="product-actions">
                            <button class="btn btn-detail" onclick="showProductDetail(${product.id})">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                            <button class="btn btn-buy" onclick="buyProduct(${product.id})">
                                <i class="fas fa-shopping-cart"></i> Beli
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            console.log(`[Render] Menampilkan ${filteredProducts.length} produk (filter: ${filter})`);
        }

        function refreshProductsDisplay() {
            const activeFilterBtn = document.querySelector('.filter-btn.active');
            const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-filter') : 'all';
            
            renderProducts(currentFilter);
            showNotification('Tampilan produk direfresh!', 'success');
        }

        function addProduct(event) {
            event.preventDefault();
            
            const name = document.getElementById('adminProductName').value.trim();
            const category = document.getElementById('adminProductCategory').value;
            const price = parseInt(document.getElementById('adminProductPrice').value);
            const description = document.getElementById('adminProductDescription').value.trim();
            const image = document.getElementById('adminProductImage').value.trim();
            
            if (!name || !category || !price || !description) {
                showNotification('Harap isi semua field wajib!', 'error');
                return;
            }
            
            const imageUrl = image || 'auto';
            
            if (currentEditProductId) {
                const productIndex = products.findIndex(p => p.id === currentEditProductId);
                if (productIndex !== -1) {
                    products[productIndex] = {
                        id: currentEditProductId,
                        name,
                        category,
                        price,
                        description,
                        image: imageUrl
                    };
                    showNotification('Produk berhasil diperbarui!', 'success');
                }
                currentEditProductId = null;
            } else {
                const newProduct = {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name,
                    category,
                    price,
                    description,
                    image: imageUrl
                };
                products.push(newProduct);
                showNotification('Produk berhasil ditambahkan!', 'success');
            }
            
            saveToLocalStorage();
            
            const activeFilter = document.querySelector('.filter-btn.active');
            renderProducts(activeFilter ? activeFilter.getAttribute('data-filter') : 'all');
            
            updateProductList();
            resetProductForm();
            
            const preview = document.getElementById('uploadPreview');
            if (preview) preview.innerHTML = '';
        }

        function updateProductList() {
            const container = document.getElementById('productList');
            const countElement = document.getElementById('productCount');
            
            if (!container) return;
            
            container.innerHTML = '';
            countElement.textContent = products.length;
            
            if (products.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); text-align: center;">Belum ada produk</p>';
                return;
            }
            
            products.forEach(product => {
                const item = document.createElement('div');
                item.className = 'product-list-item';
                item.innerHTML = `
                    <div>
                        <strong>${product.name}</strong><br>
                        <small>Rp ${product.price.toLocaleString('id-ID')} ‚Ä¢ ${getCategoryName(product.category)}</small>
                    </div>
                    <div class="product-actions-admin">
                        <button onclick="editProduct(${product.id})" class="btn-edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="btn-delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            currentEditProductId = id;
            document.getElementById('adminProductName').value = product.name;
            document.getElementById('adminProductCategory').value = product.category;
            document.getElementById('adminProductPrice').value = product.price;
            document.getElementById('adminProductDescription').value = product.description;
            document.getElementById('adminProductImage').value = product.image;
            document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Produk';
            showNotification('Edit produk - perbarui data lalu klik Update', 'info');
        }

        function resetProductForm() {
            currentEditProductId = null;
            document.getElementById('adminForm').reset();
            document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Simpan Produk';
        }

        function deleteProduct(id) {
            if (confirm('Hapus produk ini?')) {
                products = products.filter(p => p.id !== id);
                saveToLocalStorage();
                const activeFilterBtn = document.querySelector('.filter-btn.active');
                const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-filter') : 'all';
                renderProducts(currentFilter);
                updateProductList();
                showNotification('Produk berhasil dihapus!', 'success');
            }
        }

        function clearAllProducts() {
            if (confirm('HAPUS SEMUA PRODUK? Tindakan ini tidak bisa dibatalkan!')) {
                products = [];
                saveToLocalStorage();
                renderProducts('all');
                updateProductList();
                showNotification('Semua produk telah dihapus!', 'success');
            }
        }

        function exportProducts() {
            const dataStr = JSON.stringify(products, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const fileName = `${STORE_CONFIG.storeName}-products-${new Date().toISOString().split('T')[0]}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', fileName);
            link.click();
            showNotification('Produk berhasil diexport!', 'success');
        }

        function importProducts() {
            document.getElementById('importFile').click();
        }

        function refreshProductImages() {
            products.forEach(product => {
                if (product.image && product.image !== 'auto') {
                    const timestamp = Date.now();
                    if (product.image.includes('?t=')) {
                        product.image = product.image.replace(/\?t=\d+/, '?t=' + timestamp);
                    } else {
                        const separator = product.image.includes('?') ? '&' : '?';
                        product.image = product.image + separator + 't=' + timestamp;
                    }
                }
            });
            
            saveToLocalStorage();
            const activeFilterBtn = document.querySelector('.filter-btn.active');
            const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-filter') : 'all';
            renderProducts(currentFilter);
            showNotification('Gambar produk direfresh!', 'success');
        }

        function saveStoreSettings() {
            const storeName = document.getElementById('storeName').value.trim();
            const storePhone = document.getElementById('storePhone').value.trim();
            const storeQRIS = document.getElementById('storeQRIS').value.trim();
            const storeLogo = document.getElementById('storeLogo').value.trim();
            
            if (!storeName || !storePhone) {
                showNotification('Nama toko dan nomor WhatsApp wajib diisi!', 'error');
                return;
            }
            
            STORE_CONFIG.storeName = storeName;
            STORE_CONFIG.phoneNumber = storePhone;
            STORE_CONFIG.qrisUrl = storeQRIS;
            STORE_CONFIG.storeLogo = storeLogo;
            
            saveToLocalStorage();
            updateUIFromConfig();
            loadQRISImage();
            showNotification('Pengaturan toko disimpan!', 'success');
        }

        // ==================== FUNGSI UI ====================
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
                    document.getElementById(this.getAttribute('data-target')).classList.add('active');
                    document.getElementById('mainNav').classList.remove('active');
                    updateMobileMenuIcon();
                });
            });
        }

        function setupProductFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    renderProducts(this.getAttribute('data-filter'));
                });
            });
        }

        function setupPayment() {
            updateOrderSummary(currentProduct);
            
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPaymentMethod = this.getAttribute('data-method');
                    
                    const payButton = document.getElementById('payButton');
                    if (selectedPaymentMethod === 'qris') {
                        payButton.innerHTML = '<i class="fas fa-qrcode"></i> Scan QRIS untuk Bayar';
                        payButton.style.background = 'linear-gradient(to right, #FF6B00, #FF8E00)';
                    } else {
                        payButton.innerHTML = '<i class="fas fa-lock"></i> Lanjut ke Form Order';
                        payButton.style.background = 'linear-gradient(to right, #00b09b, #96c93d)';
                    }
                });
            });
            
            document.getElementById('payButton').addEventListener('click', function() {
                if (!currentProduct) {
                    showNotification('Pilih produk terlebih dahulu!', 'error');
                    return;
                }
                
                if (!selectedPaymentMethod) {
                    showNotification('Pilih metode pembayaran!', 'error');
                    return;
                }
                
                if (selectedPaymentMethod === 'qris') {
                    showQRISModal();
                } else {
                    openOrderModal(currentProduct);
                }
            });
        }

        function setupCopyButtons() {
            document.querySelectorAll('.payment-number').forEach(btn => {
                btn.addEventListener('click', function() {
                    const number = this.getAttribute('data-number');
                    navigator.clipboard.writeText(number).then(() => {
                        const notification = this.querySelector('.copy-notification');
                        notification.classList.add('show');
                        setTimeout(() => notification.classList.remove('show'), 2000);
                    }).catch(err => {
                        const textArea = document.createElement('textarea');
                        textArea.value = number;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        const notification = this.querySelector('.copy-notification');
                        notification.classList.add('show');
                        setTimeout(() => notification.classList.remove('show'), 2000);
                    });
                });
            });
        }

        function setupMobileMenu() {
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                const nav = document.getElementById('mainNav');
                nav.classList.toggle('active');
                updateMobileMenuIcon();
            });
        }

        function updateMobileMenuIcon() {
            const nav = document.getElementById('mainNav');
            const icon = document.getElementById('mobileMenuBtn').querySelector('i');
            if (nav.classList.contains('active')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        }

        function setupOrderModal() {
            const modal = document.getElementById('orderModal');
            const modalClose = document.getElementById('modalClose');
            
            if (modalClose) {
                modalClose.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            const sendButton = document.getElementById('sendWhatsApp');
            if (sendButton) {
                sendButton.addEventListener('click', function() {
                    if (currentProduct) {
                        sendOrderToWhatsApp(currentProduct);
                    }
                });
            }
        }

        function openOrderModal(product) {
            const modal = document.getElementById('orderModal');
            const orderProduct = document.getElementById('orderProduct');
            const orderPrice = document.getElementById('orderPrice');
            
            if (orderProduct) orderProduct.value = product.name;
            if (orderPrice) orderPrice.value = `Rp ${product.price.toLocaleString('id-ID')}`;
            
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('gameId').value = '';
            document.getElementById('paymentMethod').value = '';
            document.getElementById('additionalNotes').value = '';
            
            renderCaptcha();
            document.getElementById('captchaInput').value = '';
            document.getElementById('captchaStatus').textContent = '';
            captchaVerified = false;
            
            document.getElementById('robotCheck').checked = false;
            document.getElementById('robotCheckbox').classList.remove('checked');
            robotChecked = false;
            
            updateSendButton();
            modal.style.display = 'flex';
        }

        // ==================== FUNGSI BANTUAN ====================
        function loadQRISImage() {
            const qrisContainer = document.getElementById('qrisContainer');
            if (!qrisContainer || !STORE_CONFIG.qrisUrl) return;
            
            if (STORE_CONFIG.qrisUrl !== "https://files.catbox.moe/xxxxxx.png") {
                qrisContainer.innerHTML = `
                    <img src="${STORE_CONFIG.qrisUrl}" alt="QRIS ${STORE_CONFIG.storeName}" class="qr-image" onerror="handleQRISError()">
                    <p style="color: var(--success); margin-top: 10px;">
                        <i class="fas fa-check-circle"></i> QRIS aktif, scan untuk bayar
                    </p>
                `;
            }
        }

        function handleQRISError() {
            const qrisContainer = document.getElementById('qrisContainer');
            if (qrisContainer) {
                qrisContainer.innerHTML = `
                    <div style="padding: 2rem; background: #f9f9f9; border-radius: 10px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; color: #ffc107;"></i>
                        <p>QRIS akan diaktifkan segera</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Silakan pilih metode pembayaran lainnya</p>
                    </div>
                `;
            }
        }

        function updateOrderSummary(product) {
            if (!product) return;
            
            const productNameEl = document.getElementById('productName');
            const productPriceEl = document.getElementById('productPrice');
            const totalPriceEl = document.getElementById('totalPrice');
            
            if (productNameEl) productNameEl.textContent = product.name;
            if (productPriceEl) productPriceEl.textContent = `Rp ${product.price.toLocaleString('id-ID')}`;
            if (totalPriceEl) totalPriceEl.textContent = `Rp ${product.price.toLocaleString('id-ID')}`;
        }

        window.showProductDetail = function(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                alert(`Detail Produk:\n\nNama: ${product.name}\nHarga: Rp ${product.price.toLocaleString('id-ID')}\nKategori: ${getCategoryName(product.category)}\nDeskripsi: ${product.description}`);
            }
        };

        window.buyProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                currentProduct = product;
                updateOrderSummary(product);
                openOrderModal(product);
            }
        };

        function showQRISModal() {
            const modal = document.getElementById('orderModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <button class="modal-close" id="modalClose">&times;</button>
                <h2 style="color: var(--primary); margin-bottom: 1.5rem;">Pembayaran QRIS</h2>
                <div style="text-align: center;">
                    <div style="background: white; padding: 1.5rem; border-radius: 15px; display: inline-block;">
                        <img src="${STORE_CONFIG.qrisUrl}" alt="QRIS ${STORE_CONFIG.storeName}" style="width: 250px; height: 250px; object-fit: contain; border: 1px solid #eee; border-radius: 10px;" onerror="this.src='https://via.placeholder.com/250/FF6B00/FFFFFF?text=QRIS+Error'">
                    </div>
                    <div style="margin-top: 2rem;">
                        <a href="https://wa.me/${STORE_CONFIG.phoneNumber}?text=Halo%20${encodeURIComponent(STORE_CONFIG.storeName)}%2C%20saya%20sudah%20bayar%20via%20QRIS%20untuk%20${encodeURIComponent(currentProduct.name)}" 
                           class="btn-whatsapp" target="_blank">
                            <i class="fab fa-whatsapp"></i> Kirim Bukti Bayar
                        </a>
                    </div>
                </div>
            `;
            
            modal.querySelector('#modalClose').onclick = function() {
                modal.style.display = 'none';
            };
            
            modal.style.display = 'flex';
        }

        function sendOrderToWhatsApp(product) {
            if (!robotChecked) {
                showNotification('Centang "Saya Bukan Robot" terlebih dahulu!', 'error');
                return;
            }
            
            if (!captchaVerified) {
                showNotification('Verifikasi CAPTCHA terlebih dahulu!', 'error');
                return;
            }
            
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const gameId = document.getElementById('gameId').value.trim();
            const paymentMethod = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('additionalNotes').value.trim();
            
            if (!name || !phone || !gameId || !paymentMethod) {
                showNotification('Lengkapi semua field wajib!', 'error');
                return;
            }
            
            const phoneRegex = /^[0-9]{10,13}$/;
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            if (!phoneRegex.test(cleanPhone)) {
                showNotification('Nomor WhatsApp tidak valid!', 'error');
                return;
            }
            
            const message = `Halo ${STORE_CONFIG.storeName}, saya ingin memesan:

üì¶ *Produk:* ${product.name}
üí∞ *Harga:* Rp ${product.price.toLocaleString('id-ID')}
üë§ *Nama:* ${name}
üì± *WhatsApp:* ${phone}
üéÆ *ID Game/No HP:* ${gameId}
üí≥ *Metode Bayar:* ${paymentMethod}
${notes ? `üìù *Catatan:* ${notes}` : ''}

Saya sudah memesan melalui website. Bagaimana cara melanjutkan pembayaran?`;
            
            const url = `https://wa.me/${STORE_CONFIG.phoneNumber}?text=${encodeURIComponent(message)}`;
            addTransactionHistory(product, name);
            document.getElementById('orderModal').style.display = 'none';
            
            setTimeout(() => {
                window.open(url, '_blank');
            }, 500);
            
            showNotification('Order berhasil! WhatsApp akan terbuka...', 'success');
        }

        function addTransactionHistory(product, customerName) {
            let history = JSON.parse(localStorage.getItem('zarrstore_history') || '[]');
            
            const newTransaction = {
                id: `TRX${String(history.length + 1).padStart(3, '0')}`,
                product: product.name,
                date: new Date().toISOString().split('T')[0],
                amount: product.price,
                customer: customerName,
                status: 'pending'
            };
            
            history.unshift(newTransaction);
            localStorage.setItem('zarrstore_history', JSON.stringify(history));
            renderTransactionHistory();
        }

        function renderTransactionHistory() {
            const history = JSON.parse(localStorage.getItem('zarrstore_history') || '[]');
            const container = document.getElementById('historyTableBody');
            
            if (!container) return;
            
            container.innerHTML = '';
            
            history.slice(0, 10).forEach(transaction => {
                const row = document.createElement('tr');
                const statusClass = `status-${transaction.status}`;
                const statusText = transaction.status === 'completed' ? 'Selesai' : 
                                 transaction.status === 'processing' ? 'Diproses' : 'Menunggu';
                
                row.innerHTML = `
                    <td>${transaction.id}</td>
                    <td>${transaction.product}</td>
                    <td>${transaction.date}</td>
                    <td>Rp ${transaction.amount.toLocaleString('id-ID')}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                `;
                container.appendChild(row);
            });
            
            if (history.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 2rem; color: var(--gray);">
                            <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                            <p>Belum ada transaksi</p>
                        </td>
                    </tr>
                `;
            }
        }

        function showNotification(message, type) {
            const oldNotification = document.querySelector('.notification');
            if (oldNotification) {
                oldNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // ==================== FUNGSI DEVELOPER TOOLS ====================
        function addSampleProducts() {
            const sampleProducts = [
                {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name: "Mobile Legends 172 Diamond",
                    category: "game",
                    price: 50000,
                    description: "Diamond MLBB siap kirim",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 2 : 2),
                    name: "Free Fire 500 Diamond",
                    category: "game",
                    price: 100000,
                    description: "Diamond FF proses cepat",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 3 : 3),
                    name: "Pulsa Axis 25.000",
                    category: "pulsa",
                    price: 23000,
                    description: "Pulsa AXIS harga murah",
                    image: "auto"
                },
                {
                    id: (products.length > 0 ? Math.max(...products.map(p => p.id)) + 4 : 4),
                    name: "XYRAN Premium 3 Bulan",
                    category: "game",
                    price: 35000,
                    description: "Akun Xyran premium extended",
                    image: "auto"
                }
            ];
            
            products.push(...sampleProducts);
            saveToLocalStorage();
            const activeFilterBtn = document.querySelector('.filter-btn.active');
            const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-filter') : 'all';
            renderProducts(currentFilter);
            updateProductList();
            showNotification('4 produk contoh ditambahkan!', 'success');
        }

        function checkLocalStorage() {
            const totalProducts = products.length;
            const totalHistory = JSON.parse(localStorage.getItem('zarrstore_history') || '[]').length;
            
            alert(`Status LocalStorage:\n\nProduk: ${totalProducts} item\nRiwayat: ${totalHistory} transaksi\nDeveloper Mode: ${isDeveloperMode ? 'Aktif' : 'Nonaktif'}\nAuto Update: ${isAutoUpdateEnabled ? 'Aktif' : 'Nonaktif'}\n\nTotal data: ${localStorage.length} item`);
        }

        function clearAllData() {
            if (confirm('RESET SEMUA DATA?\n\nIni akan menghapus:\n‚Ä¢ Semua produk\n‚Ä¢ Semua riwayat transaksi\n‚Ä¢ Semua pengaturan\n‚Ä¢ Developer mode\n‚Ä¢ Auto Update settings\n\nTindakan ini tidak bisa dibatalkan!')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== EXPORT FUNCTIONS TO WINDOW ====================
        window.resetProductForm = resetProductForm;
        window.saveStoreSettings = saveStoreSettings;
        window.exportProducts = exportProducts;
        window.importProducts = importProducts;
        window.clearAllProducts = clearAllProducts;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.addSampleProducts = addSampleProducts;
        window.checkLocalStorage = checkLocalStorage;
        window.clearAllData = clearAllData;
        window.disableDeveloperMode = disableDeveloperMode;
        window.uploadProductImage = uploadProductImage;
        window.refreshProductImages = refreshProductImages;
        window.toggleAutoUpdate = toggleAutoUpdate;
        window.setUpdateInterval = setUpdateInterval;
        window.forceUpdateAllDevices = forceUpdateAllDevices;
        window.refreshProductsDisplay = refreshProductsDisplay;

        // Alias untuk toggleAutoUpdateUI (untuk tombol di UI)
        window.toggleAutoUpdateUI = toggleAutoUpdate;
    </script>
</body>
</html>
